<template>
  <card-wrapper
    :card-url="generatedCardUrl"
    :header-config="headerConfig"
    :og-config="ogConfig"
    class="card-halfling card-seznam-zakonov"
  >
    <div slot="info">
      <p v-t="'info.lead'" class="info-text lead"></p>
      <p v-t="'info.methodology'" class="info-text heading"></p>
      <p class="info-text">
        <span v-t="'info.text'"></span>
        <template v-for="infoLink in $t('info.links')">
          {{ ' ' }}
          <a v-t="infoLink.text" :key="infoLink.text" :href="infoLink.link"></a>
          {{ ' ' }}
        </template>
      </p>
    </div>

    <sortable-table
      :columns="columns"
      :items="mappedItems"
      :sort="currentSort"
      :sort-order="currentSortOrder"
      :sort-callback="selectSort"
      class="legislation-list"
    />
  </card-wrapper>
</template>

<script>
import SortableTable from 'components/SortableTable.vue';
import common from 'mixins/common';
import links from 'mixins/links';

export default {
  name: 'SeznamZakonovKartica',
  components: {
    SortableTable,
  },
  mixins: [
    common,
    links,
  ],
  props: {
    headerConfig: {
      type: Object,
      default: () => ({}),
    },
    ogConfig: {
      type: Object,
      default: null,
    },
    columns: {
      type: Array,
      default: () => [],
    },
    items: {
      type: Array,
      default: () => [],
    },
    currentSort: {
      type: String,
      default: '',
    },
    currentSortOrder: {
      type: String,
      default: '',
    },
    selectSort: {
      type: Function,
      default: () => {},
    },
    generatedCardUrl: {
      type: String,
      default: '',
    },
  },
  computed: {
    mappedItems() {
      const mapResultIcon = {
        enacted: {
          icon: 'glyphicon-ok',
          name: this.$t('vote-result--enacted'),
        },
        adopted: {
          icon: 'glyphicon-ok',
          name: this.$t('vote-result--adopted'),
        },
        rejected: {
          icon: 'glyphicon-remove',
          name: this.$t('vote-result--rejected'),
        },
        retracted: {
          icon: 'glyphicon-remove',
          name: this.$t('vote-result--retracted'),
        },
        submitted: {
          icon: 'v-obravnavi',
          name: this.$t('vote-result--submitted'),
        },
        received: {
          icon: 'v-obravnavi',
          name: this.$t('vote-result--received'),
        },
        in_procedure: {
          icon: 'v-obravnavi',
          name: this.$t('vote-result--in_procedure'),
        },
      };

      return this.items.map((legislation) => {
        let mapKey = legislation.result;
        if (!mapKey) {
          mapKey = 'vObravnavi';
        }

        console.log(mapKey);

        const outcomeHtml = `<div class="outcome"><i class="glyphicon ${mapResultIcon[mapKey].icon}"></i><div class="text">${mapResultIcon[mapKey].name}</div></div>`;

        return [
          { html: `<a href="${this.getLegislationLink(legislation)}" class="funblue-light-hover">${legislation.text}</a>` },
          { text: legislation.epa },
          { text: legislation.date },
          { html: outcomeHtml },
        ];
      });
    },
  },
};
</script>

<style lang="scss">
@import '~parlassets/scss/colors';
@import '~parlassets/scss/breakpoints';

.empty-dataset {
  color: $font-placeholder;
  font-style: normal !important;
}

.legislation-list {

  .column:last-child {
    margin-left: 8px;
  }

  .narrow {
    flex: 0.5 !important;
  }

  .outcome {
    margin-right: 0;

    .text {
      @include respond-to(mobile) {
        font-size:14px !important;
      }
    }

    i {
      &.glyphicon-ok {
        width: 34px !important;
        height: 28px;
      }

      &.glyphicon-remove {
        width: 28px;
        height: 27px;
      }

      &.v-obravnavi {
        width: 38px !important;
        height: 38px;
        background: url("#{getConfig('urls.cdn')}/icons/v-obravnavi.svg");
        background-size: contain !important;
        background-repeat: no-repeat;
      }
    }
  }
}
</style>
